import{a as S}from"./chunk-ZYY3GMG7-CfHCmCrr.js";import{f as F}from"./chunk-OV5NMSY6-CzJZ0JaW.js";import{D as T}from"./chunk-AMJSV3NG-DPKI1Y1t.js";import{g as L}from"./chunk-FSMQADBD-Dkr3W4bN.js";import{g as N}from"./chunk-MWVM4TYO-bKUcYSnf.js";import{a1 as P,af as I,a3 as y,b,R as A,aK as w,dh as z,j as e,H as D,u as M,a6 as O,a8 as V,a9 as B,r as H,t as v,z as K,w as o,B as R}from"./index-DVDzS5zo.js";import{a as $}from"./chunk-GDZSURH3-6d0DBo8o.js";import{K as k}from"./chunk-6HTZNHPT-CRPKDwNX.js";import{b as d,u as q}from"./chunk-6DAFMWMA-DOplJBJA.js";import{S as l}from"./select-Cd3Auim5.js";import{C as Q}from"./currency-input-BnpBEQOQ.js";import{T as U}from"./textarea-t2B5Ja1R.js";import"./chunk-K7S5TX6I-DWCQ6XGu.js";import"./chunk-MUXBF6QF-CTl6bsBs.js";import"./document-text-DjT9cj_1.js";import"./arrow-down-right-mini-B27Ba5XF.js";import"./x-circle-D5mzXh-6.js";import"./Trans-gbTvuGyt.js";import"./use-prompt-Dfdk2dg_.js";import"./prompt-BT4Q14j5.js";import"./container-BXC902rS.js";import"./status-badge-CI77RhN2.js";import"./format-C3w1D3EB.js";import"./triangles-mini-CvLZLvCX.js";import"./check-CpwEzBp2.js";import"./index.esm-DYlfXC4f.js";var W=P({amount:I(),refund_reason_id:y().nullish(),note:y().optional()}),G=({order:a,refundReasons:j})=>{const{t:n}=b(),{handleSuccess:u}=q(),p=M(),[x]=O(),h=x.get("paymentId"),g=S(a),s=g.find(r=>r.id===h),f=(s==null?void 0:s.amount)||0,t=V({defaultValues:{amount:f,note:""},resolver:B(W)});H.useEffect(()=>{const r=a.summary.pending_difference,i=(s==null?void 0:s.amount)||0,c=r<0?Math.min(r,i):i,m=c<0?c*-1:c;t.setValue("amount",m)},[s]);const{mutateAsync:C,isPending:_}=$(a.id,s==null?void 0:s.id),E=t.handleSubmit(async r=>{await C({amount:r.amount,refund_reason_id:r.refund_reason_id,note:r.note},{onSuccess:()=>{v.success(n("orders.payment.refundPaymentSuccess",{amount:F(r.amount,s==null?void 0:s.currency_code)})),u()},onError:i=>{v.error(i.message)}})});return e.jsx(d.Form,{form:t,children:e.jsxs(k,{onSubmit:E,className:"flex size-full flex-col overflow-hidden",children:[e.jsx(d.Body,{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs(l,{value:s==null?void 0:s.id,onValueChange:r=>{p(`/orders/${a.id}/refund?paymentId=${r}`,{replace:!0})},children:[e.jsx(K,{className:"txt-compact-small mb-[-6px] font-sans font-medium",children:n("orders.payment.selectPaymentToRefund")}),e.jsx(l.Trigger,{children:e.jsx(l.Value,{placeholder:n("orders.payment.selectPaymentToRefund")})}),e.jsx(l.Content,{children:g.map(r=>e.jsxs(l.Item,{value:r.id,children:[e.jsxs("span",{children:[L(r.amount,r.currency_code)," - "]}),e.jsx("span",{children:r.provider_id}),e.jsxs("span",{children:[" - (",r.id.replace("pay_",""),")"]})]},r.id))})]}),e.jsx(o.Field,{control:t.control,name:"amount",rules:{required:!0,min:0,max:f},render:({field:{onChange:r,...i}})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:n("fields.amount")}),e.jsx(o.Control,{children:e.jsx(Q,{...i,min:0,onChange:c=>{const m=c.target.value===""?null:Number(c.target.value);r(m),m&&!isNaN(m)&&(m<0||m>f?t.setError("amount",{type:"manual",message:n("orders.payment.createRefundWrongQuantity",{number:f})}):t.clearErrors("amount"))},code:a.currency_code,symbol:N(a.currency_code),value:i.value})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx(o.Field,{control:t.control,name:"note",render:({field:r})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:n("fields.note")}),e.jsx(o.Control,{children:e.jsx(U,{...r})}),e.jsx(o.ErrorMessage,{})]})})]})}),e.jsx(d.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(d.Close,{asChild:!0,children:e.jsx(R,{variant:"secondary",size:"small",children:n("actions.cancel")})}),e.jsx(R,{isLoading:_,type:"submit",variant:"primary",size:"small",disabled:!!Object.keys(t.formState.errors||{}).length,children:n("actions.save")})]})})]})})},be=()=>{const{t:a}=b(),j=A(),{order:n}=w(j.id,{fields:T}),{refund_reasons:u,isLoading:p,isError:x,error:h}=z();if(x)throw h;return e.jsxs(d,{children:[e.jsx(d.Header,{children:e.jsx(D,{children:a("orders.payment.createRefund")})}),n&&!p&&u&&e.jsx(G,{order:n,refundReasons:u})]})};export{be as Component};
