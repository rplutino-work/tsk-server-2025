import{r as m,a5 as x,j as l,m as N,b as k,H as J,a8 as q,a9 as Q,t as P,y as X,cH as Z,w as p,bL as u,I as ee,G as ae,B as R,aF as _}from"./index-DVDzS5zo.js";import{K as re}from"./chunk-6HTZNHPT-CRPKDwNX.js";import{b as c,u as te}from"./chunk-6DAFMWMA-DOplJBJA.js";import{T as le}from"./trash-BdZ7d_uU.js";var se=Object.defineProperty,h=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,I=(e,r,a)=>r in e?se(e,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[r]=a,ie=(e,r)=>{for(var a in r)C.call(r,a)&&I(e,a,r[a]);if(h)for(var a of h(r))F.call(r,a)&&I(e,a,r[a]);return e},ne=(e,r)=>{var a={};for(var t in e)C.call(e,t)&&r.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&h)for(var t of h(e))r.indexOf(t)<0&&F.call(e,t)&&(a[t]=e[t]);return a};const T=m.forwardRef((e,r)=>{var a=e,{color:t="currentColor"}=a,i=ne(a,["color"]);return m.createElement("svg",ie({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:r},i),m.createElement("path",{stroke:t,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7.5 13.056V1.944M11.278 9.278 7.5 13.056 3.722 9.278"}))});T.displayName="ArrowDownMini";var oe=Object.defineProperty,b=Object.getOwnPropertySymbols,D=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,M=(e,r,a)=>r in e?oe(e,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[r]=a,de=(e,r)=>{for(var a in r)D.call(r,a)&&M(e,a,r[a]);if(b)for(var a of b(r))L.call(r,a)&&M(e,a,r[a]);return e},ce=(e,r)=>{var a={};for(var t in e)D.call(e,t)&&r.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&b)for(var t of b(e))r.indexOf(t)<0&&L.call(e,t)&&(a[t]=e[t]);return a};const V=m.forwardRef((e,r)=>{var a=e,{color:t="currentColor"}=a,i=ce(a,["color"]);return m.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:r},i),m.createElement("path",{stroke:t,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7.5 1.944v11.112M3.722 5.722 7.5 1.944l3.778 3.778"}))});V.displayName="ArrowUpMini";var me=Object.defineProperty,g=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,A=(e,r,a)=>r in e?me(e,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[r]=a,fe=(e,r)=>{for(var a in r)B.call(r,a)&&A(e,a,r[a]);if(g)for(var a of g(r))H.call(r,a)&&A(e,a,r[a]);return e},ue=(e,r)=>{var a={};for(var t in e)B.call(e,t)&&r.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&g)for(var t of g(e))r.indexOf(t)<0&&H.call(e,t)&&(a[t]=e[t]);return a};const U=m.forwardRef((e,r)=>{var a=e,{color:t="currentColor"}=a,i=ue(a,["color"]);return m.createElement("svg",fe({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:r},i),m.createElement("path",{fill:t,fillRule:"evenodd",d:"M6.306 7.5a1.194 1.194 0 1 1 2.389 0 1.194 1.194 0 0 1-2.39 0M6.306 2.389a1.194 1.194 0 1 1 2.389 0 1.194 1.194 0 0 1-2.39 0M6.306 12.611a1.194 1.194 0 1 1 2.388 0 1.194 1.194 0 0 1-2.388 0",clipRule:"evenodd"}))});U.displayName="EllipsisVertical";var pe=x.object({key:x.string(),disabled:x.boolean().optional(),value:x.any()}),xe=x.object({metadata:x.array(pe)}),Oe=e=>{const{t:r}=k(),{isPending:a,...t}=e;return l.jsxs(c,{children:[l.jsxs(c.Header,{children:[l.jsx(c.Title,{asChild:!0,children:l.jsx(J,{children:r("metadata.edit.header")})}),l.jsx(c.Description,{className:"sr-only",children:r("metadata.edit.description")})]}),a?l.jsx(he,{}):l.jsx(ve,{...t})]})},S="metadata-form-key-label",$="metadata-form-value-label",ve=({metadata:e,hook:r,isMutating:a})=>{const{t}=k(),{handleSuccess:i}=te(),n=je(e),s=q({defaultValues:{metadata:be(e)},resolver:Q(xe)}),j=s.handleSubmit(async o=>{const d=ge(o);await r({metadata:d},{onSuccess:()=>{P.success(t("metadata.edit.successToast")),i()},onError:f=>{P.error(f.message)}})}),{fields:v,insert:K,remove:G}=X({control:s.control,name:"metadata"});function W(o){G(o)}function E(o,d){K(o+(d==="above"?0:1),{key:"",value:"",disabled:!1})}return l.jsx(c.Form,{form:s,children:l.jsxs(re,{onSubmit:j,className:"flex flex-1 flex-col overflow-hidden",children:[l.jsxs(c.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-y-auto",children:[l.jsxs("div",{className:"bg-ui-bg-base shadow-elevation-card-rest grid grid-cols-1 divide-y rounded-lg",children:[l.jsxs("div",{className:"bg-ui-bg-subtle grid grid-cols-2 divide-x rounded-t-lg",children:[l.jsx("div",{className:"txt-compact-small-plus text-ui-fg-subtle px-2 py-1.5",children:l.jsx("label",{id:S,children:t("metadata.edit.labels.key")})}),l.jsx("div",{className:"txt-compact-small-plus text-ui-fg-subtle px-2 py-1.5",children:l.jsx("label",{id:$,children:t("metadata.edit.labels.value")})})]}),v.map((o,d)=>{const f=o.disabled||!1;let w="-";return typeof o.value=="object"&&(w="{ ... }"),Array.isArray(o.value)&&(w="[ ... ]"),l.jsx(Z,{showTooltip:f,content:t("metadata.edit.complexRow.tooltip"),children:l.jsxs("div",{className:"group/table relative",children:[l.jsxs("div",{className:N("grid grid-cols-2 divide-x",{"overflow-hidden rounded-b-lg":d===v.length-1}),children:[l.jsx(p.Field,{control:s.control,name:`metadata.${d}.key`,render:({field:y})=>l.jsx(p.Item,{children:l.jsx(p.Control,{children:l.jsx(O,{"aria-labelledby":S,...y,disabled:f,placeholder:"Key"})})})}),l.jsx(p.Field,{control:s.control,name:`metadata.${d}.value`,render:({field:{value:y,...Y}})=>l.jsx(p.Item,{children:l.jsx(p.Control,{children:l.jsx(O,{"aria-labelledby":$,...Y,value:f?w:y,disabled:f,placeholder:"Value"})})})})]}),l.jsxs(u,{children:[l.jsx(u.Trigger,{className:N("invisible absolute inset-y-0 -right-2.5 my-auto group-hover/table:visible data-[state='open']:visible",{hidden:f}),disabled:f,asChild:!0,children:l.jsx(ee,{size:"2xsmall",children:l.jsx(U,{})})}),l.jsxs(u.Content,{children:[l.jsxs(u.Item,{className:"gap-x-2",onClick:()=>E(d,"above"),children:[l.jsx(V,{className:"text-ui-fg-subtle"}),t("metadata.edit.actions.insertRowAbove")]}),l.jsxs(u.Item,{className:"gap-x-2",onClick:()=>E(d,"below"),children:[l.jsx(T,{className:"text-ui-fg-subtle"}),t("metadata.edit.actions.insertRowBelow")]}),l.jsx(u.Separator,{}),l.jsxs(u.Item,{className:"gap-x-2",onClick:()=>W(d),children:[l.jsx(le,{className:"text-ui-fg-subtle"}),t("metadata.edit.actions.deleteRow")]})]})]})]})},o.id)})]}),n&&l.jsx(ae,{variant:"warning",label:t("metadata.edit.complexRow.label"),children:t("metadata.edit.complexRow.description")})]}),l.jsx(c.Footer,{children:l.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[l.jsx(c.Close,{asChild:!0,children:l.jsx(R,{size:"small",variant:"secondary",type:"button",disabled:a,children:t("actions.cancel")})}),l.jsx(R,{size:"small",type:"submit",isLoading:a,children:t("actions.save")})]})})]})})},O=m.forwardRef(({className:e,...r},a)=>l.jsx("input",{ref:a,...r,autoComplete:"off",className:N("txt-compact-small text-ui-fg-base placeholder:text-ui-fg-muted disabled:text-ui-fg-disabled disabled:bg-ui-bg-base bg-transparent px-2 py-1.5 outline-none",e)}));O.displayName="MetadataForm.GridInput";var he=()=>l.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[l.jsx(c.Body,{children:l.jsx(_,{className:"h-[148ox] w-full rounded-lg"})}),l.jsx(c.Footer,{children:l.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[l.jsx(_,{className:"h-7 w-12 rounded-md"}),l.jsx(_,{className:"h-7 w-12 rounded-md"})]})})]}),z=["string","number","boolean"];function be(e){return!e||!Object.keys(e).length?[{key:"",value:"",disabled:!1}]:Object.entries(e).map(([r,a])=>{if(!z.includes(typeof a))return{key:r,value:a,disabled:!0};let t=a;return typeof a!="string"&&(t=JSON.stringify(a)),{key:r,value:t,original_key:r}})}function ge(e){const r=e.metadata;if(!r.length||r.length===1&&!r[0].key&&!r[0].value)return null;const t={};return r.forEach(i=>{let n=i.key,s=i.value;const j=i.disabled;if(!(!n||!s)){if(j){t[n]=s;return}if(n=n.trim(),s=s.trim(),s==="true")t[n]=!0;else if(s==="false")t[n]=!1;else{const v=parseFloat(s);isNaN(v)?t[n]=s:t[n]=v}}}),t}function je(e){return e?Object.values(e).some(r=>!z.includes(typeof r)):!1}export{Oe as M};
